<!DOCTYPE html>
<html lang="en">
<head>
	<title>three.js webgl - exporter - gltf</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body {
			font-family: Monospace;
			/*background-color: #000;*/
			margin: 0px;
			overflow: hidden;
		}
		#info {
			color: #ccc;
			text-align: center;
			position: absolute;
			top: 0px; width: 100%;
			padding: 5px;
		}
	</style>
</head>
<body>

<!--<header>
	<h1>重庆数地景观</h1>
</header>

<div class="description">
	<h2>转换页面</h2>
	<P>您可以通过本页面对你的3D模型进行<b>在线查看</b>和<b>转换</b>，<b>不需要</b>任何第三方软件</P>
	<p>所有转换都发生在您的PC上，任何模型或文本都不会上传到我们的服务器或以任何方式存储。</p>
</div>

&lt;!&ndash;上传按钮&ndash;&gt;
<div class="uploadebutton">
	<form>
		<div>
			<label for="file_uploads">选择你要查看的模型文件(GLTF/DAE/OBJ)</label>
			<input type="file"
			       id="file_uploads"
			       name="file_uploads"
			       onchange="onUpload(this.files[0])"
			       accept="" multiple
			style="color:red;">
		</div>

		<br>
		&lt;!&ndash;<input type="text" disabled="disable" value="文件名" id="fileName" style="color: red">&ndash;&gt;
		<br>
		<br>
	</form>
</div>-->
<div id="info">
	 <h1>重庆数地景观</h1>
	<div class="description">
		<P>您可以通过本页面对你的3D模型进行<b>在线查看</b>和<b>转换</b>，<b>不需要</b>任何第三方软件</P>
		<p>所有转换都发生在您的电脑上，任何模型或文本都不会上传到我们的服务器或以任何方式存储。</p>
	</div>
	<div class="uploadebutton">
		<form>
			<div>
				<label for="file_uploads">选择你要查看的模型文件(GLTF/DAE/OBJ)</label>
				<br>
				<input type="file"
				       id="file_uploads"
				       name="file_uploads"
				       onchange="onUpload(this.files[0])"
				       accept="" multiple
				       style="color:red;">
			</div>
		</form>
	</div>
	<br>
	<button id="export_scene">Export Scene1</button>
	<button id="export_obj">Export WaltHead</button>
	<br/><br/>
	<label><input id="option_binary" name="visible" type="checkbox">Binary (<code>.glb</code>)</label>
</div>


<!-- 加载loaders JS文件 -->
<script type="text/javascript" src="./three/three.js"></script>
<script type="text/javascript" src="./ThirdPartyPlugin/ThreeJsPlugin/WebGL.js"></script>
<!-- GLTF加载器 -->
<script type="text/javascript" src="./ThirdPartyPlugin/ThreeJsPlugin/loaders/GLTFLoader.js"></script>
<!--obj加载器-->
<script type="text/javascript" src="./ThirdPartyPlugin/ThreeJsPlugin/loaders/OBJLoader.js"></script>
<!--gltf导出器-->
<script src="./ThirdPartyPlugin/ThreeJsPlugin/exporters/GLTFExporter.js"></script>

<!--控制器-->
<script type="text/javascript" src="./ThirdPartyPlugin/ThreeJsPlugin/controls/OrbitControls.js"></script>
<script type="text/javascript" src="./ThirdPartyPlugin/ThreeJsPlugin/loaders/DRACOLoader.js"></script>

<script>


	function exportGLTF( input ) {

		var gltfExporter = new THREE.GLTFExporter();


		//选择导出glb还是gltf
		var options = {
			binary: document.getElementById( 'option_binary' ).checked,
		};
		gltfExporter.parse( input, function ( result ) {
			if ( result instanceof ArrayBuffer ) {
				saveArrayBuffer( result, 'scene.glb' );
			} else {
				var output = JSON.stringify( result, null, 2 );
				console.log( output );
				saveString( output, 'scene.gltf' );
			}
		} ,options);
	}

	document.getElementById( 'export_scene' ).addEventListener( 'click', function () {
		exportGLTF( scene1 );
	} );

	document.getElementById( 'export_obj' ).addEventListener( 'click', function () {
		exportGLTF( waltHead );
	} );


	var link = document.createElement( 'a' );
	link.style.display = 'none';
	document.body.appendChild( link ); // Firefox workaround, see #6594

	function save( blob, filename ) {
		link.href = URL.createObjectURL( blob );
		link.download = filename;
		link.click();
	}

	function saveString( text, filename ) {
		save( new Blob( [ text ], { type: 'text/plain' } ), filename );
	}


	function saveArrayBuffer( buffer, filename ) {
		save( new Blob( [ buffer ], { type: 'application/octet-stream' } ), filename );
	}

	if ( WEBGL.isWebGLAvailable() === false ) {
		document.body.appendChild( WEBGL.getWebGLErrorMessage() );
	}

	var container;

	var camera, object, scene1, scene2, renderer, controls;
	var gridHelper, sphere, waltHead;

	init();
	animate();

	function init() {
		container = document.createElement( 'div' );
		document.body.appendChild( container );

		scene1 = new THREE.Scene();
		scene1.name = 'Scene1';

		// ---------------------------------------------------------------------
		// Perspective Camera
		// ---------------------------------------------------------------------
		camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
		camera.position.set( 600, 400, 0 );

		camera.name = "PerspectiveCamera";
		scene1.add( camera );

		// ---------------------------------------------------------------------
		// Ambient light  环境光
		// ---------------------------------------------------------------------
		var light = new THREE.AmbientLight( 0xffffff, 0.1 );
		light.name = 'AmbientLight';
		scene1.add( light );

		// ---------------------------------------------------------------------
		// DirectLight  直射光
		// ---------------------------------------------------------------------
		light = new THREE.DirectionalLight( 0xffffff, 0.1 );
		light.target.position.set( 0, 0, -1 );
		light.add( light.target );
		light.lookAt( -1, -1, 0 );
		light.name = 'DirectionalLight';
		scene1.add( light );

		// ---------------------------------------------------------------------
		// Grid  网格
		// ---------------------------------------------------------------------
	/*	gridHelper = new THREE.GridHelper( 2000, 20 );
		gridHelper.position.y = - 50;
		gridHelper.name = "Grid";
		scene1.add( gridHelper );*/

		// ---------------------------------------------------------------------
		// Axes 轴线
		// ---------------------------------------------------------------------
		/*var axes = new THREE.AxesHelper( 500 );
		axes.name = "AxesHelper";
		scene1.add( axes );
*/

		// ---------------------------------------------------------------------
		// 导入obj文件
		// ---------------------------------------------------------------------
		var loader = new THREE.OBJLoader();
		loader.load( 'ToGltf/obj/2.obj', function ( obj ) {
			waltHead = obj;
			waltHead.scale.multiplyScalar( 1.5 );
			//位置
			// waltHead.position.set( 0, 0, 0 );
			//放大倍数
			// waltHead.scale.set(7, 7, 7);
			scene1.add( waltHead );
		} );

		// ---------------------------------------------------------------------
		renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize( window.innerWidth, window.innerHeight );
		//设置背景颜色
		renderer.setClearColor(0xffffff);
		container.appendChild( renderer.domElement );
		window.addEventListener( 'resize', onWindowResize, false );

		// ---------------------------------------------------------------------
		//鼠标操作模型操作
		// ---------------------------------------------------------------------
		controls = new THREE.OrbitControls(camera, renderer.domElement);
		// 使动画循环使用时阻尼或自转 意思是否有惯性
		controls.enableDamping = true;
		//动态阻尼系数 就是鼠标拖拽旋转灵敏度
		controls.dampingFactor = 0.55;
		//是否可以缩放
		controls.enableZoom = true;
		//是否自动旋转
		controls.autoRotate = false;
		//设置相机距离原点的最远距离
		controls.minDistance = 1;
		//设置相机距离原点的最远距离
		controls.maxDistance = 200;
		//是否开启右键拖拽
		controls.enablePan = true;
	}

	// ---------------------------------------------------------------------
	function onWindowResize() {
		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		renderer.setSize( window.innerWidth, window.innerHeight );
	}

	// ---------------------------------------------------------------------
	function animate() {
		requestAnimationFrame( animate );
		render();
	}

	// ---------------------------------------------------------------------
	function render() {
		camera.lookAt( scene1.position );
		renderer.render( scene1, camera );
	}

</script>

</body>
</html>
